<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improved Table Rendering Test</title>
    <link rel="stylesheet" href="static/css/markdown-modules.css">
    <link rel="stylesheet" href="static/css/style_multi_agen.css">
    <style>
        body {
            background-color: #1c1c1e;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            padding: 2rem;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 3rem;
            padding: 2rem;
            background-color: #2c2c2e;
            border-radius: 0.75rem;
            border: 1px solid #374151;
        }
        .test-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #3b82f6;
        }
        .markdown-content {
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 style="text-align: center; margin-bottom: 2rem; color: #3b82f6;">Improved Table Rendering Test</h1>
        
        <div class="test-section">
            <div class="test-title">Basic Table</div>
            <div class="markdown-content" id="basic-table"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">Shopping List Table</div>
            <div class="markdown-content" id="shopping-table"></div>
        </div>
        
        <div class="test-section">
            <div class="test-title">Complex Table</div>
            <div class="markdown-content" id="complex-table"></div>
        </div>
    </div>

    <script>
        // Enhanced Table parsing function (same as in multi_agent.js)
        function renderMarkdown(markdownText) {
            // Store code blocks and replace with placeholders
            const codeBlocks = [];
            let html = markdownText.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const placeholder = `CODE_BLOCK_PLACEHOLDER_${codeBlocks.length}__`;
                codeBlocks.push({ lang: lang, code: code });
                return placeholder;
            });

            // Headers
            html = html.replace(/^###### (.*)$/gm, '<h6 class="markdown-h6">$1</h6>');
            html = html.replace(/^##### (.*)$/gm, '<h5 class="markdown-h5">$1</h5>');
            html = html.replace(/^#### (.*)$/gm, '<h4 class="markdown-h4">$1</h4>');
            html = html.replace(/^### (.*)$/gm, '<h3 class="markdown-h3">$1</h3>');
            html = html.replace(/^## (.*)$/gm, '<h2 class="markdown-h2">$1</h2>');
            html = html.replace(/^# (.*)$/gm, '<h1 class="markdown-h1">$1</h1>');

            // Blockquotes
            html = html.replace(/^> (.*)$/gm, '<blockquote class="markdown-blockquote"><p class="markdown-p">$1</p></blockquote>');

            // Lists
            html = html.replace(/\n(?= *- |^\d+\. )/g, '@@NEWLINE_HOLDER@@');
            html = html.replace(/^- (.*)$/gm, '<li class="markdown-li">$1</li>');
            html = html.replace(/^(\d+)\. (.*)$/gm, '<li class="markdown-li">$1. $2</li>');
            html = html.replace(/((?:<li class="markdown-li">.*?<\/li>\n?)+)/g, (match, listItems) => {
                listItems = listItems.trim();
                return `<ul class="markdown-ul">${listItems}</ul>`;
            });
            html = html.replace(/@@NEWLINE_HOLDER@@/g, '<br>');

            // Links
            html = html.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" rel="noopener noreferrer" class="markdown-a">$1</a>');

            // Images
            html = html.replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1" class="markdown-img">');

            // Enhanced Table parsing with support for various table formats
            html = html.replace(/((?:\|.*\|(?:\r?\n|\r)?)+)/g, (match) => {
                const lines = match.trim().split(/\r?\n/);
                if (lines.length < 2) return match; // Need at least header and separator
                
                // Check if it's a proper markdown table (has separator line with dashes)
                const hasSeparator = lines.some(line => 
                    line.trim().match(/^\|[\s\-:|]+\|$/)
                );
                
                if (!hasSeparator) return match; // Not a table
                
                let tableHtml = '<div class="markdown-table-wrapper"><table class="markdown-table">';
                let inHeader = true;
                let headerAdded = false;
                
                lines.forEach((line, index) => {
                    line = line.trim();
                    if (!line.startsWith('|') || !line.endsWith('|')) return;
                    
                    // Skip separator lines (lines with only dashes, colons, and pipes)
                    if (line.match(/^\|[\s\-:|]+\|$/)) {
                        inHeader = false;
                        return;
                    }
                    
                    // Parse cells
                    const cells = line.split('|').slice(1, -1).map(cell => cell.trim());
                    
                    if (inHeader && !headerAdded) {
                        tableHtml += '<thead><tr>';
                        cells.forEach(cell => {
                            tableHtml += `<th>${escapeHtml(cell)}</th>`;
                        });
                        tableHtml += '</tr></thead><tbody>';
                        headerAdded = true;
                    } else if (!inHeader) {
                        tableHtml += '<tr>';
                        cells.forEach(cell => {
                            tableHtml += `<td>${escapeHtml(cell)}</td>`;
                        });
                        tableHtml += '</tr>';
                    }
                });
                
                tableHtml += '</tbody></table></div>';
                return tableHtml;
            });

            // Math Notation
            html = html.replace(/\$\$(.*?)\$\$/gs, '<div class="markdown-math-block">$1</div>');
            html = html.replace(/\$(.*?)\$/g, '<span class="markdown-math-inline">$1</span>');

            // Inline code
            html = html.replace(/`(.*?)`/g, '<code class="markdown-code-inline">$1</code>');

            // Newlines to <br>
            html = html.replace(/\n/g, '<br>');

            // Basic bold
            html = html.replace(/\*\*(.*?)\*\*/g, '<strong class="markdown-strong">$1</strong>');

            // Basic italics
            html = html.replace(/\*(.*?)\*/g, '<em class="markdown-em">$1</em>');

            // Restore code blocks
            for (let i = 0; i < codeBlocks.length; i++) {
                const placeholder = `CODE_BLOCK_PLACEHOLDER_${i}__`;
                const block = codeBlocks[i];
                const languageClass = block.lang ? `language-${block.lang}` : 'language-markup';
                const codeHtml = `<pre class="markdown-pre"><code class="markdown-code ${languageClass}">${block.code}</code></pre>`;
                html = html.replace(placeholder, codeHtml);
            }

            return `<div class="markdown-container markdown-fade-in">${html}</div>`;
        }

        // Helper function to escape HTML special characters
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Test data
        const basicTable = `| Name | Age | City |
|------|-----|------|
| John | 25  | NYC  |
| Jane | 30  | LA   |
| Bob  | 35  | SF   |`;

        const shoppingTable = `| No. | Barang | Jumlah | Satuan |
|------|---------|--------|--------|
| 1 | Roti Tawar | 1 | Bungkus |
| 2 | Susu | 1 | Liter |
| 3 | Telur | 6 | Butir |
| 4 | Buah Apel | 1 | Kg |`;

        const complexTable = `| Product | Price | Stock | Category | Rating |
|---------|-------|-------|----------|--------|
| Laptop | $999 | 15 | Electronics | ⭐⭐⭐⭐⭐ |
| Phone | $699 | 25 | Electronics | ⭐⭐⭐⭐ |
| Book | $19 | 100 | Books | ⭐⭐⭐ |
| Coffee | $5 | 50 | Food | ⭐⭐⭐⭐⭐ |`;

        // Render the tables
        document.getElementById('basic-table').innerHTML = renderMarkdown(basicTable);
        document.getElementById('shopping-table').innerHTML = renderMarkdown(shoppingTable);
        document.getElementById('complex-table').innerHTML = renderMarkdown(complexTable);
    </script>
</body>
</html> 